"use client";

import { useSearchParams, useRouter } from "next/navigation";
import { useState, Suspense } from "react";
import { motion } from "framer-motion";
import { mbtiDescriptions } from "@/data/mbtiDescriptions";

const keywords = [
  { id: "love", label: "Ïó∞Ïï†", emoji: "üíï" },
    { id: "work", label: "ÏßÅÏû•ÏÉùÌôú", emoji: "üíº" },
      { id: "friendship", label: "Ïö∞Ï†ï", emoji: "üë´" },
        { id: "growth", label: "ÏûêÍ∏∞Í≥ÑÎ∞ú", emoji: "üìö" },
          { id: "stress", label: "Ïä§Ìä∏Î†àÏä§ Í¥ÄÎ¶¨", emoji: "üßò" },
            { id: "communication", label: "ÏÜåÌÜµ Î∞©Ïãù", emoji: "üí¨" },
            ];
            
            function ResultContent() {
              const searchParams = useSearchParams();
                const router = useRouter();
                  const mbtiType = searchParams.get("type") || "ENFP";
                    const mbtiInfo = mbtiDescriptions[mbtiType];
                    
                      const [selectedKeyword, setSelectedKeyword] = useState<string | null>(null);
                        const [advice, setAdvice] = useState<string>("");
                        
                          const handleKeyword = (keyword: string) => {
                              setSelectedKeyword(keyword);
                                  const keywordLabel = keywords.find((k) => k.id === keyword)?.label;
                                      setAdvice(
                                            `${mbtiType} Ïú†ÌòïÏùò ${keywordLabel}Ïóê ÎåÄÌïú AI ÎßûÏ∂§ Ï°∞Ïñ∏ Í∏∞Îä•ÏùÄ ÏÑúÎ≤Ñ ÌôòÍ≤ΩÏóêÏÑúÎßå ÏÇ¨Ïö©Ìï† Ïàò ÏûàÏäµÎãàÎã§.\n\nÎ°úÏª¨ÏóêÏÑú npm run devÎ°ú Ïã§ÌñâÌïòÍ≥† OpenAI API ÌÇ§Î•º ÏÑ§Ï†ïÌïòÎ©¥ AI ÎßûÏ∂§ Ï°∞Ïñ∏ÏùÑ Î∞õÏùÑ Ïàò ÏûàÏñ¥Ïöî! ‚ú®`
                                                );
                                                  };
                                                  
                                                    if (!mbtiInfo) {
                                                        return (<div>ÏûòÎ™ªÎêú MBTI Ïú†ÌòïÏûÖÎãàÎã§.</div>);
                                                          }
                                                          
                                                            return (
                                                                <main className="min-h-screen flex flex-col items-center p-4 py-8">
                                                                      <motion.div
                                                                              initial={{ opacity: 0, scale: 0.9 }}
                                                                                      animate={{ opacity: 1, scale: 1 }}
                                                                                              transition={{ duration: 0.5 }}
                                                                                                      className="cute-card max-w-lg w-full text-center mb-6"
                                                                                                            >
                                                                                                                    <motion.div
                                                                                                                              animate={{ scale: [1, 1.2, 1] }}
                                                                                                                                        transition={{ repeat: Infinity, duration: 2 }}
                                                                                                                                                  className="text-6xl mb-4"
                                                                                                                                                          >
                                                                                                                                                                    {mbtiInfo.emoji}
                                                                                                                                                                            </motion.div>
                                                                                                                                                                                    <p className="text-gray-400 mb-2">ÎãπÏã†Ïùò MBTIÎäî</p>
                                                                                                                                                                                            <h1 className="text-4xl font-bold bg-gradient-to-r from-pink-500 to-purple-500 bg-clip-text text-transparent mb-2">
                                                                                                                                                                                                      {mbtiType}
                                                                                                                                                                                                              </h1>
                                                                                                                                                                                                                      <h2 className="text-xl font-medium text-gray-600 mb-4">
                                                                                                                                                                                                                                {mbtiInfo.title}
                                                                                                                                                                                                                                        </h2>
                                                                                                                                                                                                                                                <p className="text-gray-500 leading-relaxed">{mbtiInfo.description}</p>
                                                                                                                                                                                                                                                      </motion.div>
                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                            <motion.div
                                                                                                                                                                                                                                                                    initial={{ opacity: 0, y: 20 }}
                                                                                                                                                                                                                                                                            animate={{ opacity: 1, y: 0 }}
                                                                                                                                                                                                                                                                                    transition={{ delay: 0.3 }}
                                                                                                                                                                                                                                                                                            className="cute-card max-w-lg w-full mb-6"
                                                                                                                                                                                                                                                                                                  >
                                                                                                                                                                                                                                                                                                          <h3 className="text-lg font-bold text-gray-700 mb-4 text-center">
                                                                                                                                                                                                                                                                                                                    Í∂ÅÍ∏àÌïú ÌÇ§ÏõåÎìúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî ‚ú®
                                                                                                                                                                                                                                                                                                                            </h3>
                                                                                                                                                                                                                                                                                                                                    <div className="grid grid-cols-2 gap-3">
                                                                                                                                                                                                                                                                                                                                              {keywords.map((kw) => (
                                                                                                                                                                                                                                                                                                                                                          <motion.button
                                                                                                                                                                                                                                                                                                                                                                        key={kw.id}
                                                                                                                                                                                                                                                                                                                                                                                      whileHover={{ scale: 1.05 }}
                                                                                                                                                                                                                                                                                                                                                                                                    whileTap={{ scale: 0.95 }}
                                                                                                                                                                                                                                                                                                                                                                                                                  onClick={() => handleKeyword(kw.id)}
                                                                                                                                                                                                                                                                                                                                                                                                                                className={`p-3 rounded-2xl text-sm font-medium transition-all border-2 ${
                                                                                                                                                                                                                                                                                                                                                                                                                                                selectedKeyword === kw.id
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  ? "border-purple-400 bg-purple-50 text-purple-600"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    : "border-gray-100 bg-white hover:border-purple-200 text-gray-600"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  }`}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <span className="text-lg">{kw.emoji}</span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <br />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        {kw.label}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </motion.button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              ))}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </motion.div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  {advice && (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <motion.div
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    initial={{ opacity: 0, y: 20 }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              animate={{ opacity: 1, y: 0 }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        className="cute-card max-w-lg w-full mb-6"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <h3 className="text-lg font-bold text-gray-700 mb-4">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      ü§ñ AI ÎßûÏ∂§ Ï°∞Ïñ∏
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </h3>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <p className="text-gray-600 leading-relaxed whitespace-pre-line">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      {advice}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </motion.div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              )}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <motion.button
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            whileHover={{ scale: 1.05 }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    whileTap={{ scale: 0.95 }}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            onClick={() => router.push("/")}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    className="px-8 py-3 bg-gradient-to-r from-pink-400 to-purple-400 text-white rounded-2xl font-bold shadow-lg"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  Îã§Ïãú Í≤ÄÏÇ¨ÌïòÍ∏∞ üîÑ
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </motion.button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </main>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              export default function ResultPage() {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                return (
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <Suspense
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          fallback={
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div className="min-h-screen flex items-center justify-center">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <p>Î°úÎî© Ï§ë...</p>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              >
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <ResultContent />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </Suspense>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          );
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          }"